import time, urllib2, pygame

# monitor url
url = 'http://www.shopbop.com/karen-walker/br/v=1/2534374302162611.htm'
# interval of monitor
interval = 3
# alarm audio
alarm_file = 'door_bell.wav'
# repeat times of alarm audio
repeat_time = 3
# text before monitor target
target_flag = '<div id="searchResultCount">'
# length of target text
target_length = 2


def play_alarm():
    ''' play the given alarm audio file'''
    pygame.mixer.init()
    pygame.mixer.music.load(alarm_file)
    pygame.mixer.music.play(repeat_time, 0.0)

def monitor_target(page):
    ''' return the target value '''
    page = str(page)
    index = page.find(target_flag)
    if index != -1:
        target_pos = index + len(target_flag)
        return page[target_pos:target_pos + target_length]

print 'Load url...'
base_page = urllib2.urlopen(url).read()

print 'Finding target...'
origin_value = monitor_target(base_page)

print 'Start monitor...'
while True:
    new_page = urllib2.urlopen(url).read()
    new_value = monitor_target(new_page)
    if new_value == origin_value:
        print 'Nothing changed -' + time.strftime('%H:%M:%S')
        time.sleep(interval)
    else:
        print 'Target changed! -' + time.strftime('%H:%M:%S')
        print origin_value + ' -> ' + new_value
        play_alarm()
        if str(raw_input('Keep on monitoring? y/n: ')) == 'y':
            origin_value = new_value
        else:
            exit(0)





